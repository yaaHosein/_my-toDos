{"version":3,"file":"aurelia-framework.js","sources":["../../src/framework-configuration.ts","../../src/aurelia.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/ban-types */\r\nimport * as TheLogManager from 'aurelia-logging';\r\nimport { ViewEngine, HtmlBehaviorResource } from 'aurelia-templating';\r\nimport { join } from 'aurelia-path';\r\nimport type { Container } from 'aurelia-dependency-injection';\r\nimport type { Aurelia } from './aurelia';\r\nimport type { Loader } from 'aurelia-loader';\r\n\r\nconst logger = TheLogManager.getLogger('aurelia');\r\nconst extPattern = /\\.[^/.]+$/;\r\n\r\nfunction runTasks(config: FrameworkConfiguration, tasks) {\r\n  let current;\r\n  let next = () => {\r\n    current = tasks.shift();\r\n    if (current) {\r\n      return Promise.resolve(current(config)).then(next);\r\n    }\r\n\r\n    return Promise.resolve();\r\n  };\r\n\r\n  return next();\r\n}\r\n\r\nexport interface FrameworkPluginInfo {\r\n  moduleId?: string;\r\n  resourcesRelativeTo?: string[];\r\n  configure?: (config: FrameworkConfiguration, pluginConfig?: any) => any;\r\n  config?: any;\r\n}\r\n\r\nfunction loadPlugin(fwConfig: FrameworkConfiguration, loader: Loader, info: FrameworkPluginInfo) {\r\n  logger.debug(`Loading plugin ${info.moduleId}.`);\r\n  if (typeof info.moduleId === 'string') {\r\n    fwConfig.resourcesRelativeTo = info.resourcesRelativeTo;\r\n\r\n    let id = info.moduleId; // General plugins installed/configured by the end user.\r\n\r\n    if (info.resourcesRelativeTo.length > 1 ) { // In case of bootstrapper installed plugins like `aurelia-templating-resources` or `aurelia-history-browser`.\r\n      return loader.normalize(info.moduleId, info.resourcesRelativeTo[1])\r\n        .then(normalizedId => _loadPlugin(normalizedId));\r\n    }\r\n\r\n    return _loadPlugin(id);\r\n  } else if (typeof info.configure === 'function') {\r\n    if (fwConfig.configuredPlugins.indexOf(info.configure) !== -1) {\r\n      return Promise.resolve();\r\n    }\r\n    fwConfig.configuredPlugins.push(info.configure);\r\n    // use info.config || {} to keep behavior consistent with loading from string\r\n    return Promise.resolve(info.configure.call(null, fwConfig, info.config || {}));\r\n  }\r\n  throw new Error(invalidConfigMsg(info.moduleId || info.configure, 'plugin'));\r\n\r\n  function _loadPlugin(moduleId) {\r\n    return loader.loadModule(moduleId).then(m => { // eslint-disable-line consistent-return\r\n      if ('configure' in m) {\r\n        if (fwConfig.configuredPlugins.indexOf(m.configure) !== -1) {\r\n          return Promise.resolve();\r\n        }\r\n        return Promise.resolve(m.configure(fwConfig, info.config || {})).then(() => {\r\n          fwConfig.configuredPlugins.push(m.configure);\r\n          fwConfig.resourcesRelativeTo = null;\r\n          logger.debug(`Configured plugin ${info.moduleId}.`);\r\n        });\r\n      }\r\n\r\n      fwConfig.resourcesRelativeTo = null;\r\n      logger.debug(`Loaded plugin ${info.moduleId}.`);\r\n    });\r\n  }\r\n}\r\n\r\nfunction loadResources(aurelia, resourcesToLoad, appResources) {\r\n  // if devs want to go all in static, and remove loader\r\n  // the code after this fucntion shouldn't run\r\n  // add a check to make sure it only runs when there is something to do so\r\n  if (Object.keys(resourcesToLoad).length === 0) {\r\n    return Promise.resolve();\r\n  }\r\n  let viewEngine = aurelia.container.get(ViewEngine);\r\n\r\n  return Promise.all(Object.keys(resourcesToLoad).map(n => _normalize(resourcesToLoad[n])))\r\n    .then(loads => {\r\n      let names = [];\r\n      let importIds = [];\r\n\r\n      loads.forEach(l => {\r\n        names.push(undefined);\r\n        importIds.push(l.importId);\r\n      });\r\n\r\n      return viewEngine.importViewResources(importIds, names, appResources);\r\n    });\r\n\r\n  function _normalize(load) {\r\n    let moduleId = load.moduleId;\r\n    let ext = getExt(moduleId);\r\n\r\n    if (isOtherResource(moduleId)) {\r\n      moduleId = removeExt(moduleId);\r\n    }\r\n\r\n    return aurelia.loader.normalize(moduleId, load.relativeTo)\r\n      .then(normalized => {\r\n        return {\r\n          name: load.moduleId,\r\n          importId: isOtherResource(load.moduleId) ? addOriginalExt(normalized, ext) : normalized\r\n        };\r\n      });\r\n  }\r\n\r\n  function isOtherResource(name) {\r\n    let ext = getExt(name);\r\n    if (!ext) return false;\r\n    if (ext === '') return false;\r\n    if (ext === '.js' || ext === '.ts') return false;\r\n    return true;\r\n  }\r\n\r\n  function removeExt(name) {\r\n    return name.replace(extPattern, '');\r\n  }\r\n\r\n  function addOriginalExt(normalized, ext) {\r\n    return removeExt(normalized) + '.' + ext;\r\n  }\r\n}\r\n\r\nfunction getExt(name: string) { // eslint-disable-line consistent-return\r\n  let match = name.match(extPattern);\r\n  if (match && match.length > 0) {\r\n    return (match[0].split('.'))[1];\r\n  }\r\n}\r\n\r\nfunction loadBehaviors(config: FrameworkConfiguration) {\r\n  return Promise.all(config.behaviorsToLoad.map(m => m.load(config.container, m.target))).then(() => {\r\n    config.behaviorsToLoad = null;\r\n  });\r\n}\r\n\r\nfunction assertProcessed(plugins: FrameworkConfiguration) {\r\n  if (plugins.processed) {\r\n    throw new Error('This config instance has already been applied. To load more plugins or global resources, create a new FrameworkConfiguration instance.');\r\n  }\r\n}\r\n\r\nfunction invalidConfigMsg(cfg: any, type: string) {\r\n  return `Invalid ${type} [${cfg}], ${type} must be specified as functions or relative module IDs.`;\r\n}\r\n\r\n/**\r\n * Manages configuring the aurelia framework instance.\r\n */\r\nexport class FrameworkConfiguration {\r\n  /**\r\n   * The root DI container used by the application.\r\n   */\r\n  container: Container;\r\n\r\n  /**\r\n   * The aurelia instance.\r\n   */\r\n  aurelia: Aurelia;\r\n\r\n  /**\r\n   * Plugin / feature loading instruction\r\n   * @type {FrameworkPluginInfo[]}\r\n   *\r\n   * @internal\r\n   */\r\n  info: FrameworkPluginInfo[];\r\n\r\n  /** @internal */\r\n  processed: boolean;\r\n\r\n  /** @internal */\r\n  preTasks: any[];\r\n\r\n  /** @internal */\r\n  postTasks: any[];\r\n\r\n  /** @internal */\r\n  behaviorsToLoad: any[];\r\n\r\n  /** @internal */\r\n  configuredPlugins: any[];\r\n\r\n  /** @internal */\r\n  resourcesToLoad: Record<string, any>;\r\n\r\n  /** @internal */\r\n  bootstrapperName: string;\r\n\r\n  /** @internal */\r\n  resourcesRelativeTo: string[];\r\n\r\n  /**\r\n   * Creates an instance of FrameworkConfiguration.\r\n   * @param aurelia An instance of Aurelia.\r\n   */\r\n  constructor(aurelia: Aurelia) {\r\n    this.aurelia = aurelia;\r\n    this.container = aurelia.container;\r\n    this.info = [];\r\n    this.processed = false;\r\n    this.preTasks = [];\r\n    this.postTasks = [];\r\n    /**\r\n     * Custom element's metadata queue for loading view factory\r\n     * @type {HtmlBehaviorResource[]}\r\n     */\r\n    this.behaviorsToLoad = [];\r\n    /**\r\n     * Plugin configure functions temporary cache for avoid duplicate calls\r\n     * @type {Function[]}\r\n     */\r\n    this.configuredPlugins = [];\r\n    this.resourcesToLoad = {};\r\n    this.preTask(() => aurelia.loader.normalize('aurelia-bootstrapper', undefined)\r\n      .then(name => this.bootstrapperName = name));\r\n    this.postTask(() => loadResources(aurelia, this.resourcesToLoad, aurelia.resources));\r\n  }\r\n\r\n  /**\r\n   * Adds an existing object to the framework's dependency injection container.\r\n   * @param type The object type of the dependency that the framework will inject.\r\n   * @param instance The existing instance of the dependency that the framework will inject.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  instance(type: any, instance: any): FrameworkConfiguration {\r\n    this.container.registerInstance(type, instance);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a singleton to the framework's dependency injection container.\r\n   * @param type The object type of the dependency that the framework will inject.\r\n   * @param implementation The constructor function of the dependency that the framework will inject.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  singleton(type: any, implementation?: Function): FrameworkConfiguration {\r\n    this.container.registerSingleton(type, implementation as any);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a transient to the framework's dependency injection container.\r\n   * @param type The object type of the dependency that the framework will inject.\r\n   * @param implementation The constructor function of the dependency that the framework will inject.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  transient(type: any, implementation?: Function): FrameworkConfiguration {\r\n    this.container.registerTransient(type, implementation as any);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds an async function that runs before the plugins are run.\r\n   * @param task The function to run before start.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  preTask(task: Function): FrameworkConfiguration {\r\n    assertProcessed(this);\r\n    this.preTasks.push(task);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds an async function that runs after the plugins are run.\r\n   * @param task The function to run after start.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  postTask(task: Function): FrameworkConfiguration {\r\n    assertProcessed(this);\r\n    this.postTasks.push(task);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Configures an internal feature plugin before Aurelia starts.\r\n   * @param plugin The folder for the internal plugin to configure (expects an index.js in that folder).\r\n   * @param config The configuration for the specified plugin.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  feature(plugin: string | ((config: FrameworkConfiguration, pluginConfig?: any) => any), config: any = {}): FrameworkConfiguration {\r\n    switch (typeof plugin) {\r\n    case 'string':\r\n      let hasIndex = /\\/index$/i.test(plugin);\r\n      let moduleId = hasIndex || getExt(plugin) ? plugin : plugin + '/index';\r\n      let root = hasIndex ? plugin.slice(0, -6) : plugin;\r\n      this.info.push({ moduleId, resourcesRelativeTo: [root, ''], config });\r\n      break;\r\n      // return this.plugin({ moduleId, resourcesRelativeTo: [root, ''], config });\r\n    case 'function':\r\n      this.info.push({ configure: plugin, config: config || {} });\r\n      break;\r\n    default:\r\n      throw new Error(invalidConfigMsg(plugin, 'feature'));\r\n    }\r\n    return this;\r\n    // return this.plugin(plugin, config);\r\n  }\r\n\r\n  /**\r\n   * Adds globally available view resources to be imported into the Aurelia framework.\r\n   * @param resources The relative module id to the resource. (Relative to the plugin's installer.)\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  globalResources(resources: string | Function | Array<string | Function>): FrameworkConfiguration {\r\n    assertProcessed(this);\r\n\r\n    // eslint-disable-next-line prefer-rest-params\r\n    let toAdd = Array.isArray(resources) ? resources : arguments;\r\n    let resource;\r\n    let resourcesRelativeTo = this.resourcesRelativeTo || ['', ''];\r\n\r\n    for (let i = 0, ii = toAdd.length; i < ii; ++i) {\r\n      resource = toAdd[i];\r\n      switch (typeof resource) {\r\n      case 'string':\r\n        let parent = resourcesRelativeTo[0];\r\n        let grandParent = resourcesRelativeTo[1];\r\n        let name = resource;\r\n\r\n        if ((resource.startsWith('./') || resource.startsWith('../')) && parent !== '') {\r\n          name = join(parent, resource);\r\n        }\r\n\r\n        this.resourcesToLoad[name] = { moduleId: name, relativeTo: grandParent };\r\n        break;\r\n      case 'function':\r\n        let meta = this.aurelia.resources.autoRegister(this.container, resource);\r\n        if (meta instanceof HtmlBehaviorResource && meta.elementName !== null) {\r\n          if (this.behaviorsToLoad.push(meta) === 1) {\r\n            this.postTask(() => loadBehaviors(this));\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error(invalidConfigMsg(resource, 'resource'));\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Renames a global resource that was imported.\r\n   * @param resourcePath The path to the resource.\r\n   * @param newName The new name.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n   */\r\n  globalName(resourcePath: string, newName: string): FrameworkConfiguration {\r\n    assertProcessed(this);\r\n    this.resourcesToLoad[resourcePath] = { moduleId: newName, relativeTo: '' };\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Configures an external, 3rd party plugin before Aurelia starts.\r\n   * @param plugin The ID of the 3rd party plugin to configure.\r\n   * @param pluginConfig The configuration for the specified plugin.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n */\r\n  plugin(\r\n    plugin: string | ((frameworkConfig: FrameworkConfiguration) => any) | FrameworkPluginInfo,\r\n    pluginConfig?: any\r\n  ): FrameworkConfiguration {\r\n    assertProcessed(this);\r\n\r\n    let info: FrameworkPluginInfo;\r\n    switch (typeof plugin) {\r\n    case 'string':\r\n      info = { moduleId: plugin, resourcesRelativeTo: [plugin, ''], config: pluginConfig || {} };\r\n      break;\r\n    case 'function':\r\n      info = { configure: plugin, config: pluginConfig || {} };\r\n      break;\r\n    default:\r\n      throw new Error(invalidConfigMsg(plugin, 'plugin'));\r\n    }\r\n    this.info.push(info);\r\n    return this;\r\n  }\r\n\r\n  /** @internal */\r\n  _addNormalizedPlugin(name, config?) {\r\n    let plugin = { moduleId: name, resourcesRelativeTo: [name, ''], config: config || {} };\r\n    this.info.push(plugin);\r\n\r\n    this.preTask(() => {\r\n      let relativeTo = [name, this.bootstrapperName];\r\n      plugin.moduleId = name;\r\n      plugin.resourcesRelativeTo = relativeTo;\r\n      return Promise.resolve();\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  // Default configuration helpers\r\n  // Note: Please do NOT add PLATFORM.moduleName() around those module names.\r\n  //       Those functions are not guaranteed to be called, they are here to faciliate\r\n  //       common configurations. If they are not called, we don't want to include a\r\n  //       static dependency on those modules.\r\n  //       Including those modules in the bundle or not is a decision that must be\r\n  //       taken by the bundling tool, at build time.\r\n\r\n  /**\r\n   * Plugs in the default binding language from aurelia-templating-binding.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  defaultBindingLanguage(): FrameworkConfiguration {\r\n    return this._addNormalizedPlugin('aurelia-templating-binding');\r\n  }\r\n\r\n  /**\r\n   * Plugs in the router from aurelia-templating-router.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  router(): FrameworkConfiguration {\r\n    return this._addNormalizedPlugin('aurelia-templating-router');\r\n  }\r\n\r\n  /**\r\n   * Plugs in the default history implementation from aurelia-history-browser.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  history(): FrameworkConfiguration {\r\n    return this._addNormalizedPlugin('aurelia-history-browser');\r\n  }\r\n\r\n  /**\r\n   * Plugs in the default templating resources (if, repeat, show, compose, etc.) from aurelia-templating-resources.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  defaultResources(): FrameworkConfiguration {\r\n    return this._addNormalizedPlugin('aurelia-templating-resources');\r\n  }\r\n\r\n  /**\r\n   * Plugs in the event aggregator from aurelia-event-aggregator.\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  eventAggregator(): FrameworkConfiguration {\r\n    return this._addNormalizedPlugin('aurelia-event-aggregator');\r\n  }\r\n\r\n  /**\r\n   * Sets up a basic Aurelia configuration. This is equivalent to calling `.defaultBindingLanguage().defaultResources().eventAggregator();`\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  basicConfiguration(): FrameworkConfiguration {\r\n    return this.defaultBindingLanguage().defaultResources().eventAggregator();\r\n  }\r\n\r\n  /**\r\n   * Sets up the standard Aurelia configuration. This is equivalent to calling `.defaultBindingLanguage().defaultResources().eventAggregator().history().router();`\r\n   * @return Returns the current FrameworkConfiguration instance.\r\n  */\r\n  standardConfiguration(): FrameworkConfiguration {\r\n    return this.basicConfiguration().history().router();\r\n  }\r\n\r\n  /**\r\n   * Plugs in the ConsoleAppender and sets the log level to debug.\r\n   * @param level The log level (none/error/warn/info/debug), default to 'debug'.\r\n   * @return {FrameworkConfiguration} Returns the current FrameworkConfiguration instance.\r\n  */\r\n  developmentLogging(level?: string): FrameworkConfiguration {\r\n    let logLevel = level ? TheLogManager.logLevel[level] : undefined;\r\n\r\n    if (logLevel === undefined) {\r\n      logLevel = TheLogManager.logLevel.debug;\r\n    }\r\n\r\n    this.preTask(() => {\r\n      return this.aurelia.loader.normalize('aurelia-logging-console', this.bootstrapperName).then(name => {\r\n        return this.aurelia.loader.loadModule(name).then(m => {\r\n          TheLogManager.addAppender(new m.ConsoleAppender());\r\n          TheLogManager.setLevel(logLevel);\r\n        });\r\n      });\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Loads and configures the plugins registered with this instance.\r\n   * @return Returns a promise which resolves when all plugins are loaded and configured.\r\n  */\r\n  apply(): Promise<void> {\r\n    if (this.processed) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return runTasks(this, this.preTasks).then(() => {\r\n      let loader = this.aurelia.loader;\r\n      let info = this.info;\r\n      let current;\r\n\r\n      let next = () => {\r\n        current = info.shift();\r\n        if (current) {\r\n          return loadPlugin(this, loader, current).then(next);\r\n        }\r\n\r\n        this.processed = true;\r\n        this.configuredPlugins = null;\r\n        return Promise.resolve();\r\n      };\r\n\r\n      return next().then(() => runTasks(this, this.postTasks));\r\n    });\r\n  }\r\n}\r\n\r\n/** @internal */\r\ndeclare module 'aurelia-templating' {\r\n  interface HtmlBehaviorResource {\r\n    elementName: string | null;\r\n  }\r\n}\r\n","import * as TheLogManager from 'aurelia-logging';\r\nimport {Container} from 'aurelia-dependency-injection';\r\nimport {Loader} from 'aurelia-loader';\r\nimport {BindingLanguage, ViewSlot, ViewResources, TemplatingEngine, CompositionTransaction, View, CompositionContext} from 'aurelia-templating';\r\nimport {DOM, PLATFORM} from 'aurelia-pal';\r\nimport {relativeToFile} from 'aurelia-path';\r\nimport {FrameworkConfiguration} from './framework-configuration';\r\n\r\nfunction preventActionlessFormSubmit() {\r\n  DOM.addEventListener('submit', evt => {\r\n    const target = evt.target as HTMLFormElement;\r\n    const action = target.action;\r\n\r\n    if (target.tagName.toLowerCase() === 'form' && !action) {\r\n      evt.preventDefault();\r\n    }\r\n  }, false);\r\n}\r\n\r\n/**\r\n * The framework core that provides the main Aurelia object.\r\n */\r\nexport class Aurelia {\r\n  /**\r\n   * The DOM Element that Aurelia will attach to.\r\n   */\r\n  host: Element;\r\n  /**\r\n  /**\r\n   * The loader used by the application.\r\n   */\r\n  loader: Loader;\r\n  /**\r\n   * The root DI container used by the application.\r\n   */\r\n  container: Container;\r\n  /**\r\n   * The global view resources used by the application.\r\n   */\r\n  resources: ViewResources;\r\n\r\n  /**\r\n   * The configuration used during application startup.\r\n   */\r\n  use: FrameworkConfiguration;\r\n\r\n  /** @internal */\r\n  private logger: TheLogManager.Logger;\r\n\r\n  /** @internal */\r\n  _started: Promise<this>;\r\n\r\n  /** @internal */\r\n  private hostConfigured: boolean;\r\n\r\n  /** @internal */\r\n  private root: View;\r\n\r\n  /** @internal */\r\n  private configModuleId: string;\r\n\r\n  /** @internal */\r\n  private hostSlot: ViewSlot;\r\n\r\n  /**\r\n   * Creates an instance of Aurelia.\r\n   * @param loader The loader for this Aurelia instance to use. If a loader is not specified, Aurelia will use the loader type specified by PLATFORM.Loader.\r\n   * @param container The dependency injection container for this Aurelia instance to use. If a container is not specified, Aurelia will create an empty, global container.\r\n   * @param resources The resource registry for this Aurelia instance to use. If a resource registry is not specified, Aurelia will create an empty registry.\r\n   */\r\n  constructor(loader?: Loader, container?: Container, resources?: ViewResources) {\r\n    this.loader = loader || new PLATFORM.Loader();\r\n    this.container = container || (new Container()).makeGlobal();\r\n    this.resources = resources || new ViewResources();\r\n    this.use = new FrameworkConfiguration(this);\r\n    this.logger = TheLogManager.getLogger('aurelia');\r\n    this.hostConfigured = false;\r\n    this.host = null;\r\n\r\n    this.use.instance(Aurelia, this);\r\n    this.use.instance(Loader, this.loader);\r\n    this.use.instance(ViewResources, this.resources);\r\n  }\r\n\r\n  /**\r\n   * Loads plugins, then resources, and then starts the Aurelia instance.\r\n   * @return Returns a Promise with the started Aurelia instance.\r\n   */\r\n  start(): Promise<Aurelia> {\r\n    if (this._started) {\r\n      return this._started;\r\n    }\r\n\r\n    this.logger.info('Aurelia Starting');\r\n    return this._started = this.use.apply().then(() => {\r\n      preventActionlessFormSubmit();\r\n\r\n      if (!this.container.hasResolver(BindingLanguage)) {\r\n        let message = 'You must configure Aurelia with a BindingLanguage implementation.';\r\n        this.logger.error(message);\r\n        throw new Error(message);\r\n      }\r\n\r\n      this.logger.info('Aurelia Started');\r\n      let evt = DOM.createCustomEvent('aurelia-started', { bubbles: true, cancelable: true });\r\n      DOM.dispatchEvent(evt);\r\n      return this;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Enhances the host's existing elements with behaviors and bindings.\r\n   * @param bindingContext A binding context for the enhanced elements.\r\n   * @param applicationHost The DOM object that Aurelia will enhance.\r\n   * @return Returns a Promise for the current Aurelia instance.\r\n   */\r\n  enhance(bindingContext: object = {}, applicationHost: string | Element = null): Promise<Aurelia> {\r\n    this._configureHost(applicationHost || DOM.querySelectorAll('body')[0]);\r\n\r\n    return new Promise(resolve => {\r\n      let engine = this.container.get(TemplatingEngine) as TemplatingEngine;\r\n      this.root = engine.enhance({container: this.container, element: this.host, resources: this.resources, bindingContext: bindingContext});\r\n      this.root.attached();\r\n      this._onAureliaComposed();\r\n      resolve(this);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Instantiates the root component and adds it to the DOM.\r\n   * @param root The root component to load upon bootstrap.\r\n   * @param applicationHost The DOM object that Aurelia will attach to.\r\n   * @return Returns a Promise of the current Aurelia instance.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/ban-types\r\n  setRoot(root: string | Function = null, applicationHost: string | Element = null): Promise<Aurelia> {\r\n    let instruction = {} as CompositionContext;\r\n\r\n    if (this.root && this.root.viewModel && this.root.viewModel.router) {\r\n      this.root.viewModel.router.deactivate();\r\n      this.root.viewModel.router.reset();\r\n    }\r\n\r\n    this._configureHost(applicationHost);\r\n\r\n    let engine = this.container.get(TemplatingEngine) as TemplatingEngine;\r\n    let transaction = this.container.get(CompositionTransaction);\r\n    delete (transaction as any).initialComposition;\r\n\r\n    if (!root) {\r\n      if (this.configModuleId) {\r\n        root = relativeToFile('./app', this.configModuleId);\r\n      } else {\r\n        root = 'app';\r\n      }\r\n    }\r\n\r\n    instruction.viewModel = root;\r\n    instruction.container = instruction.childContainer = this.container;\r\n    instruction.viewSlot = this.hostSlot;\r\n    instruction.host = this.host;\r\n\r\n    return engine.compose(instruction).then((r: View) => {\r\n      this.root = r;\r\n      instruction.viewSlot.attached();\r\n      this._onAureliaComposed();\r\n      return this;\r\n    });\r\n  }\r\n\r\n  /** @internal */\r\n  _configureHost(applicationHost) {\r\n    if (this.hostConfigured) {\r\n      return;\r\n    }\r\n    applicationHost = applicationHost || this.host;\r\n\r\n    if (!applicationHost || typeof applicationHost === 'string') {\r\n      this.host = DOM.getElementById(applicationHost || 'applicationHost');\r\n    } else {\r\n      this.host = applicationHost;\r\n    }\r\n\r\n    if (!this.host) {\r\n      throw new Error('No applicationHost was specified.');\r\n    }\r\n\r\n    this.hostConfigured = true;\r\n    (this.host as any).aurelia = this;\r\n    this.hostSlot = new ViewSlot(this.host, true);\r\n    this.hostSlot.transformChildNodesIntoView();\r\n    this.container.registerInstance(DOM.boundary, this.host);\r\n  }\r\n\r\n  /** @internal */\r\n  _onAureliaComposed() {\r\n    let evt = DOM.createCustomEvent('aurelia-composed', { bubbles: true, cancelable: true });\r\n    setTimeout(() => DOM.dispatchEvent(evt), 1);\r\n  }\r\n}\r\n\r\n/** @internal */\r\ndeclare module 'aurelia-templating' {\r\n  interface View {\r\n    viewModel: any;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}